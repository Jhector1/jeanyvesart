<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <link rel="stylesheet" href="/scss/stylesheet/style2.css" type="text/css">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <!--    <link rel="icon" th:href=-->
    <!--            "@{/images/favicon.png}"-->
    <!--          type="image/x-icon">-->
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <!--    <link rel="stylesheet" href="/scss/style/_style2.css" type="text/css">-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="/js_file/footer.js" type="module" defer></script>
    <!--    <script src="/js_file/social_media_share.js" type="module" defer></script>-->

    <script src="/js_file/loader.js" type="module" defer></script>

</head>

<body>
<header  th:replace="~{header.html :: header-component}" ></header>


<article class="reset-password-form">
    <div class="container mt-3 card">
        <h3>Reset your password</h3>

        <form th:object="${customerDto}" th:classappend="${validated}?${validated}: 'noclass'"
              action="/reset-password" method="post" class="form-to-reset-password">
            <input type="hidden" name="token" th:value="${token}" id="token"
                   autocomplete="off" required>

            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="new-password"
                       placeholder="Enter password"
                       name="password"
                       required
                       minlength="8"
                       maxlength="72"
                       autocomplete="new-password"
                       aria-describedby="pwHelp">
                <label for="new-password" class="form-label">New Password:</label>
                <small id="pwHelp" class="text-body-secondary">
                    Use 8–72 chars with upper, lower, number, and symbol.
                </small>
                <div class="password-valid valid-feedback">Looks good.</div>
                <div class="password-invalid invalid-feedback">Please meet the password rules.</div>
            </div>

            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="confirm-new-password"
                       placeholder="Re-enter password"
                       name="confirm_new_password"
                       required
                       minlength="8"
                       maxlength="72"
                       autocomplete="new-password">
                <label for="confirm-new-password" class="form-label">Re-enter Password:</label>
                <div class="password-valid valid-feedback">Matches.</div>
                <div class="password-invalid invalid-feedback">Passwords must match.</div>
            </div>

            <input type="submit" value="Set Password"
                   class="btn reset-btn btn-secondary btn-lg signup-button"/>
        </form>


    </div>
</article>

    <footer-component></footer-component>

</body>
<script type="module">
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.querySelector(".form-to-reset-password");
        if (!form) return;

        const pwd = document.getElementById("new-password");
        const confirm = document.getElementById("confirm-new-password");
        const STRONG = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s]).{8,72}$/;

        const toggleState = (el) => {
            el.classList.toggle("is-valid", el.validity.valid);
            el.classList.toggle("is-invalid", !el.validity.valid);
        };

        function checkStrength() {
            if (!pwd.value) {
                pwd.setCustomValidity("Please enter a password.");
            } else if (!STRONG.test(pwd.value)) {
                pwd.setCustomValidity("Use 8–72 chars with upper, lower, number, and symbol.");
            } else {
                pwd.setCustomValidity("");
            }
            toggleState(pwd);
        }

        function checkMatch() {
            if (confirm.value !== pwd.value) {
                confirm.setCustomValidity("Passwords must match.");
            } else {
                confirm.setCustomValidity("");
            }
            toggleState(confirm);
        }

        pwd.addEventListener("input", () => { checkStrength(); checkMatch(); });
        confirm.addEventListener("input", checkMatch);

        form.addEventListener("submit", (e) => {
            checkStrength(); checkMatch();
            if (!form.checkValidity()) {
                e.preventDefault();
                form.classList.add("was-validated");
            }
        });
    });
</script>

</html>